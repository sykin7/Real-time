
# Secure Chat Ultra 🚀

这是一个基于 **Supabase** (BaaS) 构建的现代化、实时、安全的 1对1 网页聊天室。
无需编写复杂的后端代码，通过纯前端 (HTML/JS) + 强大的数据库策略 (RLS) 实现企业级的聊天功能。

![Status](https://img.shields.io/badge/Status-Active-success)
![Docker](https://img.shields.io/badge/Docker-Supported-blue)
![Supabase](https://img.shields.io/badge/Supabase-Powered-green)

## ✨ 主要功能

* **🔒 极致安全**：采用 Supabase RLS (行级安全策略)，只有发件人和收件人能看到消息，拦截一切未授权访问。
* **⚡️ 实时通讯**：基于 WebSocket 的实时消息推送，毫秒级延迟。
* **📱 完美适配移动端**：解决 iOS 键盘遮挡问题，支持移动端触摸体验。
* **💾 智能历史记录**：
    * 自动加载历史消息。
    * **日期分割线**：自动按日期分组显示消息。
    * **智能滚屏**：看历史消息时不会被新消息强制拉到底部。
* **🎨 现代化 UI**：
    * 仿 WhatsApp/Telegram 气泡风格。
    * 全屏加载动画 (Loading Spinner)。
    * Toast 消息提示系统（替代原生 Alert）。
    * 断网/重连自动检测提示。
* **🐳 Docker 化部署**：支持环境变量注入，一次构建，到处运行 (Zeabur/Koyeb/VPS)。

---

## 🛠️ 后端配置 (Supabase)

在运行项目之前，你需要先去 [Supabase](https://supabase.com) 创建一个免费项目，并完成以下配置。

### 1. 初始化数据库
进入 Supabase 后台的 **SQL Editor**，运行以下代码以创建表和安全策略：

```sql
-- 1. 清理旧表（如果存在）
DROP TABLE IF EXISTS messages;

-- 2. 创建消息表
CREATE TABLE messages (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  content text,
  sender_email text,
  receiver_email text
);

-- 3. 开启安全策略 (RLS)
ALTER TABLE messages ENABLE ROW LEVEL SECURITY;

-- 4. 允许用户查看属于自己的消息
CREATE POLICY "See own messages"
ON messages FOR SELECT
USING (
  auth.jwt() ->> 'email' = sender_email
  OR
  auth.jwt() ->> 'email' = receiver_email
);

-- 5. 允许用户发送消息（强制发件人必须是自己）
CREATE POLICY "Send messages"
ON messages FOR INSERT
WITH CHECK (
  auth.jwt() ->> 'email' = sender_email
);

-- 6. 开启实时监听功能
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
````

### 2\. 关闭邮箱验证 (重要\!)

为了让用户无需验证邮箱即可直接登录：

1.  进入 **Authentication** -\> **Providers** -\> **Email**。
2.  关闭 **Confirm email** 选项。
3.  点击 **Save**。

-----

## 💻 如何运行

你可以选择以下两种方式之一来运行。

### 方式一：本地直接运行 (小白推荐)

1.  下载本项目代码。
2.  用记事本打开 `index.html`。
3.  找到代码中的配置区域，填入你的 Supabase URL 和 Key：
    ```javascript
    // 把原来的 PLACEHOLDER_... 替换成你的真实信息
    const SUPABASE_URL = '[https://你的项目ID.supabase.co](https://你的项目ID.supabase.co)'
    const SUPABASE_KEY = 'sb_publishable_你的Key...'
    ```
4.  保存，双击 `index.html` 即可在浏览器中使用。

### 方式二：Docker 部署 (推荐用于服务器/云平台)

本项目支持通过环境变量动态注入配置，无需修改代码。

**构建镜像：**

```bash
docker build -t secure-chat .
```

**运行容器：**

```bash
docker run -d -p 80:80 \
  -e SUPABASE_URL="你的真实URL" \
  -e SUPABASE_KEY="你的真实KEY" \
  secure-chat
```

打开浏览器访问 `http://localhost` 即可。

-----

## 📂 项目结构

  * `index.html`: 核心前端文件，包含所有 UI、逻辑和样式。
  * `Dockerfile`: 构建 Docker 镜像的说明书。
  * `entrypoint.sh`: 容器启动脚本，负责将环境变量注入到 HTML 中。
  * `.github/workflows`: 包含 GitHub Actions 脚本，用于自动构建并推送到 GitHub Packages。

-----

## ⚠️ 注意事项 (免费版用户)

如果你使用的是 Supabase 免费版 (Free Tier)：

  * **自动休眠**：如果项目 7 天内无任何访问，Supabase 会暂停项目。你需要登录后台点击 "Restore" 恢复。建议每周至少使用一次。
  * **并发限制**：免费版支持最多 200 人同时在线。

-----

## 📄 License

MIT License. 只有学习交流使用，请勿用于非法用途。

-----

